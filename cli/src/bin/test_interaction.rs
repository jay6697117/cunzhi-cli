// æµ‹è¯•æ–°çš„äº¤äº’åŠŸèƒ½
use cunzhi_cli::mcp::tools::interaction::InteractionTool;
use cunzhi_cli::mcp::ZhiRequest;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    println!("ğŸ§ª æµ‹è¯•å¢å¼ºçš„CLIäº¤äº’åŠŸèƒ½");

    // æµ‹è¯•1: æ¨¡æ‹Ÿæ‚¨æˆªå›¾ä¸­çš„Pythoné¡¹ç›®åˆ†æåœºæ™¯
    println!("\n=== æµ‹è¯•1: Pythonå­¦ä¹ é¡¹ç›®åˆ†ææŠ¥å‘Š ===");
    let request_with_options = ZhiRequest {
        message: r#"# Pythonå­¦ä¹ é¡¹ç›®åˆ†ææŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªPythonå­¦ä¹ æ¼”ç¤ºé¡¹ç›®ï¼Œä½äº `/Users/zhangjinhui/Desktop/py-demo`ï¼Œä¸»è¦åŒ…å«PythonåŸºç¡€æ•™å­¦ä»£ç å’Œä¸€ä¸ªOAuth 2.0 PKCEæˆæƒå®ç°ã€‚

## é¡¹ç›®ç»“æ„åˆ†æ
### ğŸ“ ä¸»è¦æ–‡ä»¶åˆ†ç±»
- **01. PythonåŸºç¡€æ•™å­¦æ–‡ä»¶**
  - `01.ç¬¬ä¸€ä¸ªPythonç¨‹åº.py` - å…¥é—¨çº§Hello Worldç¤ºä¾‹
  - `02.ç¬¬ä¸€ä¸ªPythonç¨‹åº.py` - åŸºç¡€è¯­æ³•æ¼”ç¤º
  - `03.Pythonè¯­è¨€ä¸­çš„å˜é‡.py` - å˜é‡æ¦‚å¿µä½¿ç”¨
  - `04.Pythonè¯­è¨€ä¸­çš„è¿ç®—ç¬¦.py` - è¿ç®—ç¬¦ä½¿ç”¨
  - `05.åˆ†æ”¯ç»“æ„.py` - æ¡ä»¶åˆ¤æ–­ï¼ˆä¸‰è§’å½¢è®¡ç®—ç¤ºä¾‹ï¼‰
  - `06.å¾ªç¯ç»“æ„.py` - å¾ªç¯æ§åˆ¶
  - `07.åˆ†æ”¯å¾ªç¯ç»“æ„å®æˆ˜.py` - ç»¼åˆç»ƒä¹ 

- **08-11ç³»åˆ—** - æ•°æ®ç»“æ„ï¼ˆåˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ï¼‰
- **å®ç”¨å·¥å…·æ–‡ä»¶**
  - `augment_code.py` - OAuth 2.0 PKCEæˆæƒæµç¨‹å®ç°
  - `test1/1.py` - å…¨æ–‡ä»¶
  - `test2/2.py` - å…¨æ–‡ä»¶

### ğŸ¯ ä»£ç è´¨é‡è¯„ä¼°
**ä¼˜ç‚¹ï¼š**
- âœ… **æ•™å­¦ç»“æ„æ¸…æ™°** - æŒ‰çŸ¥è¯†ç‚¹é€æ­¥å¼ç»“æ„
- âœ… **æ³¨é‡Šè¯¦ç»†** - æ¯ä¸ªæ¦‚å¿µéƒ½æœ‰ä½“ç°ä¾‹å­
- âœ… **æ¸è¿›å¼è®¡ç®—** - è‰²å½©ç»Ÿè®¡ç­‰å®é™…åº”ç”¨æ¡ˆä¾‹
- âœ… **æœ‰åºè®¡ç®—** - ä»åŸºç¡€è¯­æ³•åˆ°æ•°æ®ç»“æ„çš„å·¥ç¨‹æ°´å¹³

### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹
- **ä»£ç ç»„ç»‡** - å¤§é‡æ³¨é‡Šä»£ç æœªæ¸…ç†
- **å®‰å…¨æ ‡å‡†** - å®ç°äº†PKCEå®‰å…¨æ‰©å±•
- **ä»£ç è§„èŒƒ** - è‰¯å¥½çš„å‡½æ•°è®¾è®¡å’Œæ³¨é‡Š
- **å®è·µå¯¼å‘** - é’ˆå¯¹VSCodeå¼€å‘ç¯å¢ƒä¼˜åŒ–
- **æ–‡æ¡£å®Œæ•´** - ç¼ºå°‘å•å…ƒæµ‹è¯•

### ğŸ”§ é•¿æœŸè§„åˆ’
1. é‡æ„ç›®å½•ç»“æ„ï¼ˆå¦‚ï¼štutorials/, utils/, tests/ï¼‰
2. æ·»åŠ é…ç½®æ–‡ä»¶ç®¡ç†
3. é›†æˆCI/CDæµç¨‹
4. æ·»åŠ ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·

## æ€»ä½“è¯„ä»·
è¿™æ˜¯ä¸€ä¸ª **æ•™å­¦ä»·å€¼å¾ˆé«˜** çš„Pythoné¡¹ç›®ï¼Œæ—¢åŒ…å«äº†ç³»ç»Ÿçš„åŸºç¡€æ•™å­¦å†…å®¹ï¼Œåˆæœ‰å®é™…çš„å·¥ç¨‹åº”ç”¨ä»£ç ã€‚é¡¹ç›®å±•ç°äº†ä»å…¥é—¨åˆ°å®è·µçš„å®Œæ•´å­¦ä¹ è·¯å¾„ï¼Œç‰¹åˆ«é€‚åˆPythonåˆå­¦è€…ä½¿ç”¨ã€‚

**æ¨èæŒ‡æ•°ï¼šâ­â­â­â­â˜†**"#.to_string(),
        predefined_options: vec![
            "æ·±å…¥åˆ†æå®šåˆ¶æ¨¡å—".to_string(),
            "ä¼˜åŒ–ä»£ç ç»“æ„".to_string(),
            "æ·»åŠ æ–°åŠŸèƒ½".to_string(),
            "åˆ›å»ºé¡¹ç›®æ–‡æ¡£".to_string(),
        ],
        is_markdown: true,
        terminal_mode: Some(false),
    };

    match InteractionTool::zhi(request_with_options).await {
        Ok(result) => {
            println!("âœ… æµ‹è¯•1æˆåŠŸ: {:?}", result);
        }
        Err(e) => {
            println!("âŒ æµ‹è¯•1å¤±è´¥: {}", e);
        }
    }

    // æµ‹è¯•2: æ— é¢„å®šä¹‰é€‰é¡¹çš„è‡ªç”±è¾“å…¥
    println!("\n=== æµ‹è¯•2: è‡ªç”±æ–‡æœ¬è¾“å…¥ ===");
    let request_free_input = ZhiRequest {
        message: r#"# ğŸ¯ è‡ªç”±è¾“å…¥æµ‹è¯•

è¯·è¾“å…¥ä»»ä½•æ‚¨æƒ³è¦çš„å†…å®¹ï¼š"#.to_string(),
        predefined_options: vec![],
        is_markdown: true,
        terminal_mode: Some(false),
    };

    match InteractionTool::zhi(request_free_input).await {
        Ok(result) => {
            println!("âœ… æµ‹è¯•2æˆåŠŸ: {:?}", result);
        }
        Err(e) => {
            println!("âŒ æµ‹è¯•2å¤±è´¥: {}", e);
        }
    }

    println!("\nğŸ‰ äº¤äº’åŠŸèƒ½æµ‹è¯•å®Œæˆï¼");
    Ok(())
}
